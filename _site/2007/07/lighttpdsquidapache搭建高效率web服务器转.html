<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Lighttpd+Squid+Apache搭建高效率Web服务器[转] | 佳音的博客</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Lighttpd+Squid+Apache搭建高效率Web服务器[转]" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="架构原理" />
<meta property="og:description" content="架构原理" />
<link rel="canonical" href="http://localhost:4000/2007/07/lighttpdsquidapache%E6%90%AD%E5%BB%BA%E9%AB%98%E6%95%88%E7%8E%87web%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BD%AC.html" />
<meta property="og:url" content="http://localhost:4000/2007/07/lighttpdsquidapache%E6%90%AD%E5%BB%BA%E9%AB%98%E6%95%88%E7%8E%87web%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BD%AC.html" />
<meta property="og:site_name" content="佳音的博客" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2007-07-17T18:40:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Lighttpd+Squid+Apache搭建高效率Web服务器[转]" />
<script type="application/ld+json">
{"headline":"Lighttpd+Squid+Apache搭建高效率Web服务器[转]","url":"http://localhost:4000/2007/07/lighttpdsquidapache%E6%90%AD%E5%BB%BA%E9%AB%98%E6%95%88%E7%8E%87web%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BD%AC.html","dateModified":"2007-07-17T18:40:00+08:00","datePublished":"2007-07-17T18:40:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2007/07/lighttpdsquidapache%E6%90%AD%E5%BB%BA%E9%AB%98%E6%95%88%E7%8E%87web%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BD%AC.html"},"description":"架构原理","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="佳音的博客" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">佳音的博客</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Lighttpd+Squid+Apache搭建高效率Web服务器[转]</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2007-07-17T18:40:00+08:00" itemprop="datePublished">Jul 17, 2007
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h2 id="架构原理">架构原理</h2>

<p>源: <a href="http://blog.sina.com.cn/u/4cbfbde50100093l">http://blog.sina.com.cn/u/4cbfbde50100093l</a></p>

<p><a href="http://www.apache.org/"><font color="#000033">Apache</font></a>通常是开源界的首选Web服务器，因为它的强大和可靠，已经具有了品牌效应，可以适用于绝大部分的应用场合。但是它的强大有时候却显得笨重，配置文件得让人望而生畏，高并发情况下效率不太高。而轻量级的Web服务器<a href="http://lighttpd.net/"><font color="#000033">Lighttpd</font></a>却 是后起之秀，其静态文件的响应能力远高于Apache，据说是Apache的2-3倍。Lighttpd的高性能和易用性，足以打动我们，在它能够胜任的 领域，尽量用它。Lighttpd对PHP的支持也很好，还可以通过Fastcgi方式支持其他的语言，比如Python。</p>

<p>毕竟Lighttpd是轻量级的服务器，功能上不能跟Apache比，某些应用无法胜任。比如Lighttpd还不支持缓存，而现在的绝大部分站点 都是用程序生成动态内容，没有缓存的话即使程序的效率再高也很难满足大访问量的需求，而且让程序不停的去做同一件事情也实在没有意义。首先，Web程序是 需要做缓存处理的，即把反复使用的数据做缓存。即使这样也还不够，单单是启动Web处理程序的代价就不少，缓存最后生成的静态页面是必不可少的。而做这个 是 <a href="http://www.squid-cache.org/"><font color="#000033">Squid</font></a>的强项，它本是做代理的，支持高效的缓存，可以用来给站点做反向代理加速。把Squid放在Apache或者Lighttpd的前端来缓存 Web服务器生成的动态内容，而Web应用程序只需要适当地设置页面实效时间即可。</p>

<p>即使是大部分内容动态生成的网站，仍免不了会有一些静态元素，比如图片、JS脚本、CSS等等，将Squid放在Apache或者Lighttp前 端后，反而会使性能下降，毕竟处理HTTP请求是Web服务器的强项。而且已经存在于文件系统中的静态内容再在Squid中缓存一下，浪费内存和硬盘空 间。因此可以考虑将Lighttpd再放在Squid的前面，构成 Lighttpd+Squid+Apache的一条处理链，Lighttpd在最前面，专门用来处理静态内容的请求，把动态内容请求通过proxy模块转 发给Squid，如果Squid中有该请求的内容且没有过期，则直接返回给Lighttpd。新请求或者过期的页面请求交由Apache中Web程序来处 理。经过Lighttpd和Squid的两级过滤，Apache需要处理的请求将大大减少，减少了Web应用程序的压力。同时这样的构架，便于把不同的处 理分散到多台计算机上进行，由Lighttpd在前面统一把关。</p>

<p>在这种架构下，每一级都是可以进行单独优化的，比如Lighttpd可以采用异步IO方式，Squid可以启用内存来缓存，Apache可以启用MPM 等，并且每一级都可以使用多台机器来均衡负载，伸缩性很好。</p>

<h2 id="实例讲解">实例讲解</h2>

<p>下面以daviesliu.net和rainbud.net域下面的几个站点为例来介绍一下此方案的具体做法。daviesliu.net域下有几个用 <a href="http://www.modpython.org/"><font color="#000033">mod_python</font></a>实现的<a href="http://blog.daviesliu.net/"><font color="#000033">blog站点</font></a>，几个php的站点，一个<a href="http://share.daviesliu.net/"><font color="#000033">mod_python的小程序</font></a>，以后可能还会架设几个PHP和<a href="http://www.djangoproject.com/"><font color="#000033">Django</font></a>的站点。而服务器非常弱，CPU为Celeron 500，内存为PC 100 384M，因此比较关注Web服务器的效率。这几个站点都是采用虚拟主机方式，开在同一台机器的同一个端口上。</p>

<p>Lighttpd服务于80端口，Squid运行在3128端口，Apache运行在81端口。</p>

<h3 id="lighttpd的配置">Lighttpd的配置</h3>

<p>多个域名采用/var/www/domain/subdomain 的目录结构，用evhost模块配置document-root如下：</p>

<blockquote>
  <p>evhost.path-pattern</p>
</blockquote>


  </div><a class="u-url" href="/2007/07/lighttpdsquidapache%E6%90%AD%E5%BB%BA%E9%AB%98%E6%95%88%E7%8E%87web%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BD%AC.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">佳音的博客</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">佳音的博客</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/zhangjiayin"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">zhangjiayin</span></a></li><li><a href="https://www.twitter.com/zhangjiayin"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">zhangjiayin</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>方乃做人之本，圆乃处世之道.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
