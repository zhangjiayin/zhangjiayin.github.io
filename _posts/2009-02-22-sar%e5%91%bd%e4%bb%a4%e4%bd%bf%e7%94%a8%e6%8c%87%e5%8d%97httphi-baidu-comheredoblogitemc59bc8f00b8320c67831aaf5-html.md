---
layout: post
title: sar命令使用指南[http://hi.baidu.com/heredo/blog/item/c59bc8f00b8320c67831aaf5.html]
date: 2009-02-22 16:48:00.000000000 +08:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories: []
tags: []
meta:
  dsq_thread_id: '4543641041'
author: 
permalink: "/2009/02/sar%e5%91%bd%e4%bb%a4%e4%bd%bf%e7%94%a8%e6%8c%87%e5%8d%97httphi-baidu-comheredoblogitemc59bc8f00b8320c67831aaf5-html.html"
---
sar命令使用指南

2008年06月03日 星期二 下午 02:18

| 

sar命令使用指南  
 在使用UNIX操作系统的过程中，我们常常会用到各种各样的问题，比如系统运行速度 突然变慢，系统容易死机或者主机所带的终端常出现死机，这时我们常常猜测，是硬盘空间太小，还是内存不足？I/O出现瓶颈，或者是系统的核心参数出了问题？这时，我们应该考虑使用系统给我们提供的sar命令来对系统作一个了解，该命令是系统维护 的重要工具，主要帮助我们掌握系统资源的使用情况，特别是内存和CPU 的使用情况， 是UNIX系统使用者应该掌握的工具之一。   
 sar 命令行的常用格式：

sar [options] [-A] [-o file] t [n]

在命令行中，n 和t 两个参数组合起来定义采样间隔和次数，t为采样间隔，是必须有的参数，n为采样次数，是可选的，默认值是1，-o file表示将命令结果以二进制格式 存放在文件中，file 在此处不是关键字，是文件名。options 为命令行选项，sar命令 的选项很多，下面只列出常用选项：

　　-A：所有报告的总和。   
 　　-u：CPU利用率   
 　　-v：进程、I节点、文件和锁表状态。   
 　　-d：硬盘使用报告。   
 　　-r：没有使用的内存页面和硬盘块。   
 　　-g：串口I/O的情况。   
 -b：缓冲区使用情况。   
 -a：文件读写情况。   
 -c：系统调用情况。   
 -R：进程的活动情况。   
 -y：终端设备活动情况。   
 -w：系统交换活动。

下面将举例说明。

例一：使用命令行 sar -u t n

例如，每60秒采样一次，连续采样5次，观察CPU 的使用情况，并将采样结果以二进制形式存入当前目录下的文件zhou中，需键入如下命令：

# sar -u -o zhou 60 5

屏幕显示：

　　SCO\_SV　　　scosysv　3.2v5.0.5　i80386　　　10/01/2001   
 　　14:43:50　　　%usr　　　%sys　　%wio　　　　%idle(-u)   
 　　14:44:50　　　0　　　　　1　　　　4　　　　　　94   
 　　14:45:50　　　0　　　　　2　　　　4　　　　　　93   
 　　14:46:50　　　0　　　　　2　　　　2　　　　　　96   
 　　14:47:50　　　0　　　　　2　　　　5　　　　　　93   
 　　14:48:50　　　0　　　　　2　　　　2　　　　　　96   
 　　Average　　　 0　　　　　2　　　　4　　　　　　94

在显示内容包括：

　　%usr：CPU处在用户模式下的时间百分比。   
 　　%sys：CPU处在系统模式下的时间百分比。   
 　　%wio：CPU等待输入输出完成时间的百分比。   
 　　%idle：CPU空闲时间百分比。

在所有的显示中，我们应主要注意%wio和%idle，%wio的值过高，表示硬盘存在I/O瓶颈，%idle值高，表示CPU较空闲，如果%idle值高但系统响应慢时，有可能是CPU等待分配内存，此时应加大内存容量。%idle值如果持续低于10，那么系统的CPU处理能力相对较低，表明系统中最需要解决的资源是CPU。

如果要查看二进制文件zhou中的内容，则需键入如下sar命令：

　　# sar -u -f zhou

可见，sar命令即可以实时采样，又可以对以往的采样结果进行查询。

例二：使用命行sar -v t n

例如，每30秒采样一次，连续采样5次，观察核心表的状态，需键入如下命令：

# sar -v 30 5

屏幕显示：   
 　　SCO\_SV scosysv 3.2v5.0.5 i80386 10/01/2001   
 　　10:33:23 proc-sz ov inod-sz ov file-sz ov lock-sz　　 (-v)   
 10:33:53　305/　321 　0　1337/2764　 0　1561/1706　0　40/　128   
 10:34:23　308/　321 　0　1340/2764　 0　1587/1706　0　37/　128   
 10:34:53　305/　321 　0　1332/2764　 0　1565/1706　0　36/　128   
 10:35:23　308/　321 　0　1338/2764　 0　1592/1706　0　37/　128   
 10:35:53　308/　321　 0　1335/2764　 0　1591/1706　0　37/　128

显示内容包括：

proc-sz：目前核心中正在使用或分配的进程表的表项数，由核心参数MAX-PROC控制。

　　inod-sz：目前核心中正在使用或分配的i节点表的表项数，由核心参数   
 MAX-INODE控制。

　　file-sz： 目前核心中正在使用或分配的文件表的表项数，由核心参数MAX-FILE控制。

　　ov：溢出出现的次数。

　　Lock-sz：目前核心中正在使用或分配的记录加锁的表项数，由核心参数MAX-FLCKRE控制。

显示格式为

实际使用表项/可以使用的表项数

显示内容表示，核心使用完全正常，三个表没有出现溢出现象，核心参数不需调整，如果出现溢出时，要调整相应的核心参数，将对应的表项数加大。

例三：使用命行sar -d t n

例如，每30秒采样一次，连续采样5次，报告设备使用情况，需键入如下命令：

# sar -d 30 5

屏幕显示：

　　SCO\_SV scosysv 3.2v5.0.5 i80386 10/01/2001   
 11:06:43 device　%busy　　　avque　　　r+w/s　　blks/s　　avwait avserv (-d)   
 11:07:13 wd-0　　　1.47　　　2.75　　　4.67　　　14.73　　 5.50 3.14   
 11:07:43 wd-0　　　0.43　　　18.77　　 3.07　　　8.66　　　25.11 1.41   
 11:08:13 wd-0　　　0.77　　　2.78　　　2.77　　　7.26　　　4.94 2.77   
 11:08:43 wd-0　　　1.10　　　11.18　　 4.10　　　11.26　　 27.32 2.68   
 11:09:13 wd-0　　　1.97　　　21.78　　 5.86　　　34.06　　　69.66 3.35   
 Average wd-0　　　1.15　　　12.11　　 4.09　　　15.19　　　31.12 2.80

显示内容包括：

device： sar命令正在监视的块设备的名字。   
 　　%busy： 设备忙时，传送请求所占时间的百分比。   
 　　avque： 队列站满时，未完成请求数量的平均值。   
 　　r+w/s： 每秒传送到设备或从设备传出的数据量。   
 　　blks/s： 每秒传送的块数，每块512字节。   
 　　avwait： 队列占满时传送请求等待队列空闲的平均时间。   
 　　avserv： 完成传送请求所需平均时间（毫秒）。

在显示的内容中，wd-0是硬盘的名字，%busy的值比较小，说明用于处理传送请求的有效时间太少，文件系统效率不高，一般来讲，%busy值高些，avque值低些，文件系统的效率比较高，如果%busy和avque值相对比较高，说明硬盘传输速度太慢，需调整。

例四：使用命行sar -b t n

例如，每30秒采样一次，连续采样5次，报告缓冲区的使用情况，需键入如下命令：

# sar -b 30 5

屏幕显示：

　　SCO\_SV scosysv 3.2v5.0.5 i80386 10/01/2001   
 14:54:59 bread/s lread/s %rcache bwrit/s lwrit/s %wcache pread/s pwrit/s (-   
 14:55:29　0　　147　　100　 5　　21　　78　　 0　　　0   
 14:55:59　0　　186　　100　 5　　25　　79　　 0　　　0   
 14:56:29　4　　232 　　98　 8　　58　　86　　 0　　　0   
 14:56:59　0　　125　　100　 5　　23　　76　　 0　　　0   
 14:57:29　0　　 89　　100　 4　　12　　66　　 0　　　0   
 Average　 1　　156 　　99　 5　　28　　80　　 0　　　0

显示内容包括：

bread/s： 每秒从硬盘读入系统缓冲区buffer的物理块数。   
 lread/s： 平均每秒从系统buffer读出的逻辑块数。   
 %rcache： 在buffer cache中进行逻辑读的百分比。   
 bwrit/s： 平均每秒从系统buffer向磁盘所写的物理块数。   
 lwrit/s： 平均每秒写到系统buffer逻辑块数。   
 %wcache： 在buffer cache中进行逻辑读的百分比。   
 pread/s： 平均每秒请求物理读的次数。   
 pwrit/s： 平均每秒请求物理写的次数。

在显示的内容中，最重要的是%cache和%wcache两列，它们的值体现着buffer的使用效率，%rcache的值小于90或者%wcache的值低于65，应适当增加系统buffer的数量，buffer数量由核心参数NBUF控制，使%rcache达到90左右，%wcache达到80左右。但buffer参数值的多少影响I/O效率，增加buffer，应在较大内存的情况下，否则系统效率反而得不到提高。

例五：使用命行sar -g t n

例如，每30秒采样一次，连续采样5次，报告串口I/O的操作情况，需键入如下命令：

# sar -g 30 5

屏幕显示：

SCO\_SV scosysv 3.2v5.0.5 i80386　　11/22/2001   
 17:07:03 　ovsiohw/s　 ovsiodma/s　　ovclist/s (-g)   
 17:07:33　　　0.00　　　0.00　　　0.00   
 17:08:03　　　0.00　　　0.00　　　0.00   
 17:08:33　　　0.00　　　0.00　　　0.00   
 17:09:03　　　0.00　　　0.00　　　0.00   
 17:09:33　　　0.00　　　0.00　　　0.00   
 Average 　　　0.00　　　0.00　　　0.00

显示内容包括：

ovsiohw/s：每秒在串口I/O硬件出现的溢出。

ovsiodma/s：每秒在串口I/O的直接输入输出通道高速缓存出现的溢出。

ovclist/s ：每秒字符队列出现的溢出。

在显示的内容中，每一列的值都是零，表明在采样时间内，系统中没有发生串口I/O溢出现象。

sar命令的用法很多，有时判断一个问题，需要几个sar命令结合起来使用，比如，怀疑CPU存在瓶颈，可用sar -u 和sar -q来看，怀疑I/O存在瓶颈，可用sar -b、sar -u和sar-d来看，以上举出的五例仅仅是其中的一部分，有兴趣的朋友不妨一试。

 |

]]\>

